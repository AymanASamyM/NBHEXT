var partyNum = 0;
var ratings = [2821,2601,2531,2592,2571,2419,2442,2449,2340,2494,2711,2618,2698,2418,2609,2470,2770,2245,2464,2524,2334,2539,2405,2454,2329,2538,2478,2526,2377,2447,2309,2608,2118,2063,2231,2396,2240,2263,2136,2359,2398,1990,2021,2300,2250,2272,2398,2246,2722,2560,2124,2400,2790,2137,2461,2670,2294,2264,2600,2273,2311,2566,2442,2272,2419,2474,2395,2663,2234,2506,2605,2239,2516,2589,2332,2244,2140,2347,2211,2016,2225,2480,2164,2492,2430,2087,2239,2332,2302,2495,2408,2215,2480,2100,2152,2052,2283,2419,2059,2251,2221,2045,2274,1984,2166,2056,2079,2083,2177,2149,2017,2262,2356,1911,2219,1945,2551,1963,2031,2104,1968,2090,2091,2124,2043,1984,1909,2065,2138,2383,2132,1919,2094,2348,2203,2075,1994,2028,2200,1946,2204,2197,1903,2430,1908,2349,2514,2572,2188,2015,2121,2157,2364,2017,2143,2349,2100,1914,1905,2157,2324,2063,1952,2346,1928,1939,2094,2200,2400,2230,2087,1990,2255,2109,2053,2315,2359,2198,2222,1904,2046,2044,1926,2088,1943,1957,2084,2046,2040,2075,2114,1947,2031,2157,1953,2254,2017,2313,2088,1994,2133,2265,1910,1919,1943,1994,2217,1989,1939,1942,2049,1939,1960,1982,2000,1907,2015,2000,2013,2331,1998,1960,2280,1967,2198,1930,1900,1923,2157,2163,1918,2051,1911,2201,1954,1920,2046,1957,1948,1984,1986,1906,2096,2143,2147,1942,1904,2142,1983,1901,2065,1951,1986,2162,2223,1996,2178,2046,1921,2167,1900,2002,2338,2146,2142,2186,2162,1936,2206,1909,2209,1982,2225,2053,2009,2160,1911,2236,2012,1987,2003,2023,2259,2047,2127,2015,2289,1916,1934,1969,2080,2131,1933,2018,2216,2060,2105,2006,2011,2041,1906,2086,2132,1997,1988,1920,2087,1900,1907,2007,2032,2007,1980,1916,1994,2102,1901,2080,2109,1913,2138,2149,1958,1923,1978,2043,2101,2006,2287,1920,1926,2041,1980,2026,1905,1910,1976,1986,1995,2049,2168,2087,2001,1925,1934,1980,1930,1941,2101,2031,1909,2076,2291,1907,1961,2209,2041,1947,2065,1975,2056,1959,1956,1958,2201,1966,1909,2007,1990,2063,2009,1915,1939,1912,1989,2086,2022,2021,1908,1994,2109,2111,1953,1943,1916];
var places = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,38,40,41,41,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,97,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,114,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,147,149,150,151,152,153,154,155,156,157,158,159,159,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,184,184,187,188,189,190,191,192,193,194,195,195,197,198,198,200,201,202,202,204,205,206,207,208,209,209,211,212,213,214,215,216,216,218,219,220,221,222,223,224,224,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,240,242,243,244,245,246,247,248,249,250,251,252,253,253,255,256,257,258,259,260,261,262,263,264,265,266,267,267,269,269,271,271,273,273,273,273,277,277,277,280,280,280,283,283,285,286,286,286,289,290,290,290,290,294,294,294,297,297,297,300,301,301,301,304,304,306,306,306,306,310,311,311,311,314,315,316,316,318,319,320,321,322,323,323,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,339,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370];
var deltas = [];
var numbers = [];

function modifyPartyHtml(index, elem)
{
    var delta = 0;
    if (partyNum > 0)
    {
        var handle = $(elem).find("td:eq(1)").find("a").first().html();
        delta = Math.round(deltas[numbers[handle]]);
    }
    var text;
    if (partyNum == 0)
    {
        text = "<th class='top right' style='width: 4em;'><span title='Rating change''>&Delta;</span></th>";
    }
    else
    {
        var darkClass = "";
        if (partyNum % 2 == 1)
            darkClass = "dark ";
        if (delta > 0)
            text = "<td class='" + darkClass + "'><span style='color:green;font-weight:bold;'>+" + delta + "</span></td>";
        else
            text = "<td class='" + darkClass + "right'><span style='color:gray;font-weight:bold;'>" + (delta > 0 ? "-" : "") + delta + "</span></td>";        
    }
    ++partyNum;
    $(elem).append(text);
}

function showPreRatings()
{
    var contestId = document.location.href.replace(/\D+/ig, ',').substr(1).split(',')[0];
    $.getJSON("http://codeforces.com/api/contest.standings?contestId=" + contestId,
        function(data)
        {
            var handles = "";
            for (var i = 0; i < data.result.rows.length; ++i)
            {
                // places[i] = data.result.rows[i].rank;
                handles += data.result.rows[i].party.members[0].handle + ";";
                numbers[data.result.rows[i].party.members[0].handle] = i;
            }
            $.getJSON("http://codeforces.com/api/user.info?handles=" + handles,
                function(data)
                {
                    // for (var i = 0; i < data.result.length; ++i)
                    //     ratings[i] = data.result[i].rating;
                    deltas = CalculateRatingChanges(ratings, places, []);
                    $(".standings").find("tr").first().find("th").last().removeClass("right");
                    $(".standings").find("tr").find("td").removeClass("right");
                    $(".standings").find("tr").each(modifyPartyHtml);
                    $(".standings").find("tr").last().find("td").last().html("<td class='smaller bottom dark right'> </td>");
                }
            );
        }
    );
}

showPreRatings();